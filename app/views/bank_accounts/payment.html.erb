<% currency = Currency.find(current_user[:currency_id]) %>
<% transactions = Transaction.where(bank_account: @bank_account) %>
<% money_in = transactions.calculate(:sum, :money_in) %>
<% money_out = transactions.calculate(:sum, :money_out) %>

<h1>Make a payment from <%= @bank_account[:account_name] %></h1>
<h2>Account number: <%= @bank_account[:account_number] %> | Sort code: <%= @bank_account[:sort_code] %></h2>
<h3>Balance: <%= number_to_currency((money_in - money_out) / currency[:rate_to_gbp], :unit => currency[:symbol]) %></h3>

<%= link_to("Return to view all accounts", '/account') %>

<%= form_with(model: @transaction, url: 'send_payment', local: true) do |f| %>
    <%= error_messages_for(f.object) %>
    <p>This payment will be from the following account: <%= @bank_account[:account_name] %></p>
    <p>To (account number)</p>
    <%= f.text_field(:account_number) %>
    <p>To (sort code)</p>
    <%= f.text_field(:sort_code) %>
    <p>Amount</p>
    <%= f.text_field(:amount) %>
    <p>Description / Purpose</p>
    <%= f.text_field(:description) %>
    <p>Reference</p>
    <%= f.text_field(:reference) %>
    <br><br>
    <%= f.submit("Send payment", data: { confirm: 'Are you sure?' }) %>
<% end %>